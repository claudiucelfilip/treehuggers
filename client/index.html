<!DOCTYPE html>
<html>
    <head>
        <title>TreeHuggers :: Login</title>
        <meta charset="UTF-8">

        <link rel="stylesheet" type="text/css" href="assets/css/index.css">
        <script src="scripts/global.js"></script>
        <script src="scripts/libs/jquery-2.1.1.js"></script>
    </head>
    <body>
        <script>
            function getProfile() {
                FB.api('/me', function(response) {
                    $.ajax({
                        type: 'POST',
                        url: TH.global.endpoints.login,
                        data: JSON.stringify(response),
                        contentType: "application/json; charset=utf-8",
                        dataType: 'json',
                        xhrFields: { withCredentials: true },
                        success: function(data) {
                            window.location.href = TH.global.clientUrl + 'game.html';
                        }
                    });
                });
            }

            function statusChangeCallback(response) {
                if (response.status === 'connected') {
                    getProfile();
                } else if (response.status === 'not_authorized') {
                    document.getElementById('status').innerHTML = 'Please log ' +
                    'into this app.';
                } else {
                    document.getElementById('status').innerHTML = 'Please log ' +
                    'into Facebook.';
                }
            }

            function checkLoginState() {
                FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                });
            }

            window.fbAsyncInit = function() {
                FB.init({
                    appId      : '1375113666117184',
                    cookie     : true,
                    xfbml      : true,
                    version    : 'v2.2'
                });

                FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                });

            };

            // Load the SDK asynchronously
            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "http://connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>

        <div id="island">
            <img src="assets/images/index/island.jpg" width="400" alt="island" class="blur" />
            <div id="login">
                <fb:login-button scope="public_profile,email" data-size="xlarge"  onlogin="checkLoginState();"></fb:login-button>
                <div id="status"></div>
            </div>
        </div>
    </body>
</html>
